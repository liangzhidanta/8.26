# ğŸ¯ ä½ç§©åˆ†è§£è®­ç»ƒç³»ç»Ÿ

åŸºäºQwenVL3Bè§†è§‰ç‰¹å¾çš„ä½ç§©è‡ªé€‚åº”åˆ†è§£è®­ç»ƒç³»ç»Ÿï¼Œæ”¯æŒSVDåŸºå‡†å¯¹æ¯”å’Œç©ºé—´å¸ƒå±€å¯è§†åŒ–ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸš€ è®­ç»ƒç³»ç»Ÿ
- **è¶…å‚æ•°é…ç½®**: æ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’ŒShellè„šæœ¬
- **æ—©åœæœºåˆ¶**: è¿ç»­10ä¸ªéªŒè¯æŸå¤±ä¸ä¸‹é™è‡ªåŠ¨åœæ­¢
- **ç‰¹å¾ç¼“å­˜**: é¿å…é‡å¤å¤„ç†å›¾åƒï¼Œæé«˜æ•ˆç‡

### ğŸ” æ€§èƒ½å¯¹æ¯”
- **SVDåŸºå‡†**: æˆªæ–­SVDç†è®ºæœ€ä¼˜è§£
- **ç¥ç»ç½‘ç»œ**: ä½ç§©è‡ªé€‚åº”åˆ†è§£æ¨¡å‹
- **å®šé‡è¯„ä¼°**: ä½™å¼¦ç›¸ä¼¼åº¦ã€é‡æ„è¯¯å·®ç­‰æŒ‡æ ‡

### ğŸ¨ å¯è§†åŒ–ç³»ç»Ÿ
- **ç©ºé—´å¸ƒå±€**: 16Ã—16ç‰¹å¾å›¾å±•ç¤ºå‰8ä¸ªé€šé“
- **å¯¹æ¯”åˆ†æ**: åŸå§‹ç‰¹å¾ vs SVDé‡æ„ vs ç¥ç»ç½‘ç»œé‡æ„
- **è¯¯å·®åˆ†å¸ƒ**: é‡æ„è¯¯å·®çš„ç©ºé—´åˆ†å¸ƒå¯è§†åŒ–

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# æ¿€æ´»condaç¯å¢ƒ
conda activate mllm

# æ£€æŸ¥GPU
nvidia-smi
```

### 2. è®­ç»ƒæ¨¡å‹
```bash
# ä½¿ç”¨Shellè„šæœ¬ï¼ˆæ¨èï¼‰
./train.sh [batch_size] [epochs] [lr] [rank] [lambda_B] [lambda_ortho] [results_dir]

# ç¤ºä¾‹ï¼šåŸºç¡€è®­ç»ƒ
./train.sh 8 20 0.001 128 0.0001 0.001 results

# ç›´æ¥ä½¿ç”¨Python
python train_real_data.py --batch_size 8 --epochs 20 --lr 0.001 --rank 128
```

### 3. æ€§èƒ½å¯¹æ¯”
```bash
# æ¯”è¾ƒSVDå’Œç¥ç»ç½‘ç»œ
python compare_svd_nn.py --rank 128
```

### 4. å¯è§†åŒ–ç»“æœ
```bash
# ç©ºé—´å¸ƒå±€å¯è§†åŒ–
python visualize_svd_nn.py --image_idx 0 --rank 128 --results_dir results
```

## ğŸ“‹ å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--batch_size` | 8 | è®­ç»ƒæ‰¹æ¬¡å¤§å° |
| `--epochs` | 20 | è®­ç»ƒè½®æ•° |
| `--lr` | 0.001 | å­¦ä¹ ç‡ |
| `--rank` | 128 | ä½ç§©åˆ†è§£çš„ç§© |
| `--lambda_B` | 0.0001 | BçŸ©é˜µæ­£åˆ™åŒ–æƒé‡ |
| `--lambda_ortho` | 0.001 | æ­£äº¤æ€§æŸå¤±æƒé‡ |
| `--weight_decay` | 0.00001 | æƒé‡è¡°å‡ |
| `--patience` | 10 | æ—©åœè€å¿ƒå€¼ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
low_rank_image/
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ train.sh                    # Shellè®­ç»ƒè„šæœ¬
â”œâ”€â”€ train_real_data.py         # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ compare_svd_nn.py          # SVD vs NNæ¯”è¾ƒ
â”œâ”€â”€ visualize_svd_nn.py        # ç©ºé—´å¸ƒå±€å¯è§†åŒ–
â”œâ”€â”€ qwenvl_dataloader.py       # æ•°æ®åŠ è½½å™¨
â”œâ”€â”€ model.py                   # ä½ç§©åˆ†è§£æ¨¡å‹
â”œâ”€â”€ svd_baseline.py            # SVDåŸºå‡†å®ç°
â”œâ”€â”€ test_real_qwenvl.py        # æ•°æ®åŠ è½½å™¨æµ‹è¯•
â”œâ”€â”€ feature_cache_real/        # ç‰¹å¾ç¼“å­˜ç›®å½•
â”‚   â”œâ”€â”€ features_0.pt         # 4370ä¸ªç‰¹å¾æ–‡ä»¶
â”‚   â”œâ”€â”€ features_1.pt
â”‚   â””â”€â”€ ...
â””â”€â”€ results/                   # è®­ç»ƒç»“æœç›®å½•
    â”œâ”€â”€ best_model.pt         # æœ€ä½³æ¨¡å‹
    â”œâ”€â”€ history.json          # è®­ç»ƒå†å²
    â”œâ”€â”€ loss_curves.png       # æŸå¤±æ›²çº¿
    â””â”€â”€ ...
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ç‰¹å¾æå–
- **æ¨¡å‹**: Qwen/Qwen2.5-VL-3B-Instruct
- **å›¾åƒå°ºå¯¸**: 448Ã—448åƒç´ 
- **Patchå°ºå¯¸**: 16Ã—16
- **ç‰¹å¾ç»´åº¦**: [256, 2048] (16Ã—16 tokens, 2048ç»´ç‰¹å¾)
- **æ•°æ®é›†**: textVQA_groundingtask_bbox (4370ä¸ªæ ·æœ¬)

### æ¨¡å‹æ¶æ„
- **è¾“å…¥**: [batch_size, 256, 2048]
- **è¾“å‡º**: [batch_size, 256, 2048]
- **åˆ†è§£**: X â‰ˆ A Ã— Bï¼Œå…¶ä¸­Aâˆˆ[batch_size, 256, rank], Bâˆˆ[batch_size, rank, 2048]

### è®­ç»ƒç­–ç•¥
- **ä¼˜åŒ–å™¨**: AdamW
- **å­¦ä¹ ç‡è°ƒåº¦**: ReduceLROnPlateau
- **æŸå¤±å‡½æ•°**: é‡æ„æŸå¤± + BçŸ©é˜µæ­£åˆ™åŒ– + æ­£äº¤æ€§æŸå¤±
- **æ—©åœ**: éªŒè¯MSEè¿ç»­10ä¸ªepochä¸ä¸‹é™

## ğŸ“Š æ€§èƒ½ç»“æœ

### æµ‹è¯•é›†æ€§èƒ½ (80ä¸ªæ ·æœ¬)
- **SVDå¹³å‡ä½™å¼¦ç›¸ä¼¼åº¦**: 0.9919 Â± 0.0021
- **NNå¹³å‡ä½™å¼¦ç›¸ä¼¼åº¦**: 0.7935 Â± 0.0371
- **æ€§èƒ½å·®è·**: SVDæ¯”ç¥ç»ç½‘ç»œé«˜çº¦20%

### å•å›¾é‡æ„è´¨é‡
- **SVDé‡æ„ç›¸ä¼¼åº¦**: 0.9910
- **NNé‡æ„ç›¸ä¼¼åº¦**: 0.8073

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´è®­ç»ƒæµç¨‹
```bash
# 1. å¼€å§‹è®­ç»ƒ
./train.sh 8 20 0.001 128 0.0001 0.001 results_custom

# 2. ç­‰å¾…è®­ç»ƒå®Œæˆï¼ˆæ”¯æŒæ—©åœï¼‰

# 3. æ¯”è¾ƒæ€§èƒ½
python compare_svd_nn.py --rank 128

# 4. å¯è§†åŒ–ç»“æœ
python visualize_svd_nn.py --image_idx 0 --rank 128 --results_dir results_custom
```

### å‚æ•°è°ƒä¼˜
```bash
# å°è¯•ä¸åŒçš„rankå€¼
./train.sh 8 20 0.001 64 0.0001 0.001 results_rank64
./train.sh 8 20 0.001 256 0.0001 0.001 results_rank256

# å°è¯•ä¸åŒçš„å­¦ä¹ ç‡
./train.sh 8 20 0.0005 128 0.0001 0.001 results_lr5e4
./train.sh 8 20 0.002 128 0.0001 0.001 results_lr2e3
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **CUDAå†…å­˜ä¸è¶³**: å‡å°batch_size
2. **è®­ç»ƒä¸æ”¶æ•›**: è°ƒæ•´å­¦ä¹ ç‡æˆ–lambdaå‚æ•°
3. **ç‰¹å¾åŠ è½½å¤±è´¥**: æ£€æŸ¥feature_cache_realç›®å½•
4. **æ¨¡å‹æ–‡ä»¶ç¼ºå¤±**: å…ˆè¿è¡Œè®­ç»ƒè„šæœ¬

### è°ƒè¯•æ¨¡å¼
```bash
# æµ‹è¯•æ•°æ®åŠ è½½å™¨
python test_real_qwenvl.py

# æ£€æŸ¥ç‰¹å¾ç»´åº¦
ls -la feature_cache_real/ | head -5
```

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

### å¯èƒ½çš„æ”¹è¿›
1. **å¤šGPUè®­ç»ƒ**: æ”¯æŒåˆ†å¸ƒå¼è®­ç»ƒ
2. **æ›´å¤šå¯è§†åŒ–**: äº¤äº’å¼å¯è§†åŒ–ã€æ›´å¤šé€šé“å±•ç¤º
3. **è¶…å‚æ•°ä¼˜åŒ–**: è‡ªåŠ¨è¶…å‚æ•°æœç´¢
4. **æ¨¡å‹å‹ç¼©**: é‡åŒ–ã€å‰ªæç­‰ä¼˜åŒ–

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚

---

**æ³¨æ„**: é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½QwenVL3Bæ¨¡å‹ï¼ˆçº¦6GBï¼‰ï¼Œè¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ã€‚



